version: '3.8'

# Docker Compose setup for local CI testing
# Alternative to 'act' for more control over the testing environment

services:
  ubuntu-gcc-12:
    image: ubuntu:22.04
    volumes:
      - .:/workspace:rw
    working_dir: /workspace
    environment:
      - CC=gcc-12
      - CXX=g++-12
      - CMAKE_BUILD_TYPE=Release
      - CMAKE_CXX_STANDARD=20
    command: >
      bash -c "
        apt-get update &&
        apt-get install -y gcc-12 g++-12 cmake make &&
        cmake . -BBUILD -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_STANDARD=20 &&
        cmake --build BUILD --config Release --target compile_proptest test_proptest test_proptest_mini --parallel &&
        cd BUILD &&
        ./compile_proptest &&
        ./test_proptest --gtest_output=xml:test_results.xml &&
        ./test_proptest_mini
      "

  ubuntu-clang-15:
    image: ubuntu:22.04
    volumes:
      - .:/workspace:rw
    working_dir: /workspace
    environment:
      - CC=clang-15
      - CXX=clang++-15
      - CMAKE_BUILD_TYPE=Release
      - CMAKE_CXX_STANDARD=20
    command: >
      bash -c "
        apt-get update &&
        apt-get install -y clang-15 cmake make &&
        cmake . -BBUILD -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_STANDARD=20 &&
        cmake --build BUILD --config Release --target compile_proptest test_proptest test_proptest_mini --parallel &&
        cd BUILD &&
        ./compile_proptest &&
        ./test_proptest --gtest_output=xml:test_results.xml &&
        ./test_proptest_mini
      "
